<%= form_with(model: [event, participant], 
              id: dom_id(participant), 
              class: "space-y-4 bg-gray-50 p-4 rounded-md shadow-sm mb-6",
              data: { controller: "properties" }) do |f| %>
  
  <% if participant.errors.any? %>
    <div class="text-red-500 text-sm">
      <%= participant.errors.full_messages.join(", ") %>
    </div>
  <% end %>

  <div>
    <%= f.label :name, "名前", class: "block text-sm font-medium text-gray-700" %>
    <%= f.text_field :name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm", placeholder: "参加者名" %>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700">属性 (例: 趣味, 部署)</label>
    
    <div data-properties-target="container">
      <%# Dynamic fields will be added here %>
    </div>

    <button type="button" 
            data-action="properties#add"
            class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
      + 属性を追加
    </button>
  </div>

  <div>
    <%= f.submit "追加する", class: "w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
  </div>

  <template data-properties-target="template">
    <div class="property-field flex space-x-2 mt-2">
      <input type="text" name="participant[properties_attributes][TEMPLATE_INDEX][key]" placeholder="項目名 (例: 趣味)" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
      <input type="text" name="participant[properties_attributes][TEMPLATE_INDEX][value]" placeholder="値 (例: サッカー)" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
      <button type="button" data-action="properties#remove" class="text-red-600 hover:text-red-800">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
  </template>
<% end %>
